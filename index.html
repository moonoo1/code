<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>AES 복호화</title>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 30px;
    }
    input, button {
      width: 100%;
      padding: 10px;
      margin-top: 10px;
      font-size: 16px;
    }
    .result {
      margin-top: 15px;
      font-size: 16px;
      word-break: break-all;
    }
    a {
      color: #0066cc;
    }
  </style>
</head>
<body>

<h2>AES 코드 복호화</h2>

<input id="encrypted" placeholder="암호화된 코드 입력" />
<button onclick="decrypt()">복호화</button>

<div id="result" class="result"></div>

<script>
  const KEY = CryptoJS.enc.Utf8.parse("k8D1v9S2E4xP0A7M5QWcZB3YH6RLTJmN");
  const IV  = CryptoJS.enc.Utf8.parse("1234567890123456");

  function decrypt() {
    const input = document.getElementById("encrypted").value.trim();
    const resultDiv = document.getElementById("result");
    resultDiv.innerHTML = "";

    if (!input) {
      alert("값을 입력하세요");
      return;
    }

    try {
      // URL-safe Base64 → Base64
      let base64 = input.replace(/-/g, "+").replace(/_/g, "/");
      while (base64.length % 4 !== 0) base64 += "=";

      const decrypted = CryptoJS.AES.decrypt(
        { ciphertext: CryptoJS.enc.Base64.parse(base64) },
        KEY,
        { iv: IV, mode: CryptoJS.mode.CBC, padding: CryptoJS.pad.Pkcs7 }
      );

      const plainText = decrypted.toString(CryptoJS.enc.Utf8);

      if (!plainText) {
        resultDiv.innerText = "❌ 복호화 실패";
        return;
      }

      // 기본 출력 (패턴 아니면 그대로 보여줌)
      let outputNode = document.createTextNode(plainText);

      // xxx_yyy 패턴 검사
      const parts = plainText.split("_");
      if (parts.length === 2) {
        const [site, code] = parts;

        let url = "";
        switch (site) {
          case "jhmungu":
            url = `https://www.jhmungu.com/shop/goods_detail.php?ps_uid=${code}`;
            break;
          case "hangarambiz":
            url = `https://www.hangarambiz.kr/shop/goods_detail.php?ps_uid=${code}`;
            break;
          case "metaldiy":
            url = `https://www.metaldiy.com/item/itemView.do?itemId=${code}`;
            break;
        }

        // 사이트가 매칭되면 링크로 출력
        if (url) {
          const a = document.createElement("a");
          a.href = url;
          a.target = "_blank";
          a.innerText = url;
          outputNode = a;
        }
      }

      resultDiv.appendChild(outputNode);
    }
    catch (e) {
      resultDiv.innerText = "❌ 복호화 오류";
      console.error(e);
    }
  }
</script>

</body>
</html>
